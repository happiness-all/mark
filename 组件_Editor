<template>
  <div>
    <div>
      <textarea :id='txtid'
                name="content">

      </textarea>
      <div :id='errotxtid'></div>
    </div>
  </div>
</template>
<script>
/// <editor :conthtmls='conthtml' :ewidth="'100%'" :eheight="'200px'" :emaxHeight="'220px'" :maxContNum='250'/>
/// 实例参数说明：conthtml初始值内容， ewidth设置editor的宽度，eheight高度， emaxHeight最大高度限制 maxContNum最大字数限制（检测中文汉字）

// import { mapState, mapActions } from 'vuex'
import server from '../../api/server'
// import { cookie } from '../api/common.js'
let editor = null
export default {
  name: 'editor2',
  data () {
    return {
      cont: '',
      flag: false,
      htmlcont: '',
      idtxt: ''
    }
  },
  props: {
    conthtmls: String,
    uploadUrl: Function,
    eheight: String,
    ewidth: String,
    emaxHeight: String,
    maxContNum: Number,
    txtid: String,
    errotxtid: String
  },
  watch: {
    conthtmls (newval, oldval) {
      this.conthtmls = newval
      editor.html(newval)
    },
    txtid (newval, oldval) {
      this.idtxt = newval
    }
  },
  // created () {
  // , 'multiimage'
  // },
  mounted () {
    this.initEditor(this.conthtmls, this.txtid)
  },
  methods: {
    initEditor (initCont, id) {
      let _this = this
      let that = this
      editor = KindEditor.create('#' + id, {
        width: that.ewidth,
        height: that.eheight,
        minHeight: '200px',
        maxHeight: that.emaxHeight,
        filterMode: true,
        resizeType: 0,
        imageUploadLimit: 10,
        imageSizeLimit: '2MB',
        items: [
          // 'fullscreen',
          'fontname', 'fontsize', 'justifyfull', 'bold', 'italic', 'underline', 'forecolor',
          'hilitecolor', '|', 'justifyleft', 'justifycenter', 'justifyright', 'removeformat', 'link', 'image', 'fullscreen'
        ],
        designMode: true,
        allowUpload: true, // true时显示上传图片标签 , 'indent', 'outdent'
        allowFileManager: true, // true时显示浏览服务器图片功能。
        dir: 'image',
        extraFileUploadParams: {
          // fileType: '2',
          catalog: 'knowledge_image'
        },
        fieldName: 'file', // 不要修改
        filePostName: 'file',
        uploadJson: server.list.uploadFile,
        fileManagerJson: server.list.uploadFile,
        afterCreate: function () {
          document.getElementsByClassName('ke-container')[0].setAttribute('style', 'max-height:' + _this.emaxHeight + '')
          if (!this.fullscreenMode && !(document.getElementById(id) && document.getElementById(id).value)) {
            this.sync()
            this.html(initCont)
          }
        },
        afterUpload: function (data) {
          // 上传成功后，执行的方法
        },
        afterError: function (data) {
          // 上传失败后，执行的方法
        },
        afterChange: function () {
          this.sync()
          this.html()
          // if (this.count('text') > _this.maxContNum) {
          //   //提示大于5000字符
          //   document.getElementById(this.txtid).setAttribute('maxflag', true)
          // } else {
          //   document.getElementById(this.txtid).setAttribute('maxflag', false)
          // }
          // if (this.count('text') === 0) {
          //   document.getElementById(this.txtid).setAttribute('requireflag', true)
          // } else {
          //   document.getElementById(this.txtid).setAttribute('requireflag', false)
          // }
          // this.html()
        }
      })
    }
  }
}
</script>

<style>
/* .ke-dialog-body .ke-button-common .ke-button {
  display: none;
} */
.tab2 .ke-button-common .ke-button {
  display: block !important;
}
.tab2 .ke-upload-area {
  width: 100% !important;
}
.editor-tip {
  margin: 10px 0;
  color: #f42f3d;
}
.editor-tip img {
  position: relative;
  left: 0;
  top: -2px;
  width: 16px;
  height: 16px;
  margin-right: 6px;
}
/* .ke-tabs-ul li:nth-child(1){
  display: none;
} */
</style>

